---
title: "HW1_implementation"
output: html_document
date: "2025-01-25"
---

```{r}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
#source(here("source", "utils.R"))
#source(here("simulations", "run_sim_wald.R"))

set.seed(50)
```

### 1.1: ADEMP Structure 

Answer the following questions: 

* How many simulation scenarios will you be running?
We will be running 3 * 3 * 2   = 18 simulation scenarios

* What are the estimand(s)
The estimands are the average treatment effect $\beta_{treatment}$ and the 
standard error of treatment effect $se(\beta_{treatment})$

* What method(s) are being evaluated/compared?

3 methods are being compared - Wald confidence intervals, nonparametric 
bootstrap percentile intervals, and nonparametric boostrap t-intervals.

* What are the performance measure(s)?
The performance measures are bias, coverage, and computation time.

# 1.2: nSim
Based on desired coverage of 95\% with Monte Carlo error of no more than 1\%, how many simulations ($n_{sim}$) should we perform for each simulation scenario?  Implement this number of simulations throughout your simulation study.


```{r}
mc_err <- 0.01
cover <- 0.95
alpha <- 1 - 0.95
n_sim <- (cover * (1 - cover))/mc_err^2
n_sim



```
# Wald coverages
```{r}
library(dplyr)

# Define the number of scenarios
# only first 8 done for boot_t


num_scenarios <- 18

# Initialize an empty data frame to store results
coverage_results <- data.frame(
  scenario = integer(),
  coverage_percentage = numeric()
)

# Loop through each scenario file
for (i in 1:num_scenarios) {
  file_path <- here("results", "sim_wald", paste0("scenario_", i, ".RDA"))
    load(file_path)
  
  # Calculates the coverage percentage
  all_ones <- all_wald_estim %>% filter(coverage == 1)
  coverage_percentage <- (nrow(all_ones) / 475) * 100

  coverage_results <- rbind(
    coverage_results,
    data.frame(scenario = i, coverage_percentage = coverage_percentage)
  )
}

print(coverage_results)


```



# Bootstrap percentile coverages
```{r}

library(dplyr)

# Define the number of scenarios
# only first 8 done for boot_t


num_scenarios <- 1

# Initialize an empty data frame to store results
coverage_results <- data.frame(
  scenario = integer(),
  coverage_percentage = numeric()
)

# Loop through each scenario file
for (i in 1:num_scenarios) {
  file_path <- here("results", "sim_boot_percentile", paste0("scenario_", i, ".RDA"))
    load(file_path)
  
  # Calculates the coverage percentage
  all_ones <- all_boot_percent_estim %>% filter(coverage == 1)
  coverage_percentage <- (nrow(all_ones) / 475) * 100

  coverage_results <- rbind(
    coverage_results,
    data.frame(scenario = i, coverage_percentage = coverage_percentage)
  )
}

print(coverage_results)



```

# Bootstrap t coverages
```{r}

library(dplyr)

# Define the number of scenarios
# only first 8 done for boot_t


num_scenarios <- 1

# Initialize an empty data frame to store results
coverage_results <- data.frame(
  scenario = integer(),
  coverage_percentage = numeric()
)

# Loop through each scenario file
for (i in 1:num_scenarios) {
  file_path <- here("results", "sim_boot_t", paste0("scenario_", i, ".RDA"))
  load(file_path)
  
  # Calculates the coverage percentage
  all_ones <- all_boot_t_estim %>% filter(coverage == 1)
  coverage_percentage <- (nrow(all_ones) / 475) * 100

  coverage_results <- rbind(
    coverage_results,
    data.frame(scenario = i, coverage_percentage = coverage_percentage)
  )
}

print(coverage_results)



```

```{r}
file_path <- here("results", "sim_data", paste0("scenario_", 1, ".RDA"))
load(file_path)

all_sim_data
```


```{r}
file_path <- here("results", "sim_boot_percentile", paste0("scenario_", 1, ".RDA"))
load(file_path)

all_boot_percent_estim
```

